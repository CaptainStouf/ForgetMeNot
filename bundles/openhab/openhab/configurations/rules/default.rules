
import org.openhab.core.library.types.*

/* 
rule "Update ventillation status on switch"
	when
		Item global_Vent_Switch received command ON
	then
	
		var status = sendHttpGetRequest("http://192.168.0.155/status")
		postUpdate(global_Vent_Status, status)
		//send Command(global_Vent_Status, )
end
*/


// http://fr.wikipedia.org/wiki/Pente_(math%C3%A9matiques)
// Valeur humidity précédente
var Number xA = 0
var Number yA = 0
// Valeur humidity courante
var Number xB = 0
var Number yB = 0

rule "Check fast humidity increase" 
	when
		Item firstFloor_Bathroom_Humidity received update
	then
		var Number currentValue = firstFloor_Bathroom_Humidity.state as DecimalType
		var Number currentEpoch = now().getMillis() / 1000.0
		if (xA == 0){
			xA = currentEpoch
			yA = currentValue
		} else if(xB == 0){
			xB = currentEpoch
			yB = currentValue
		} else {
			xA = xB;
			yA = yB;
			xB = currentEpoch
			yB = currentValue
		}
		
		if (xB != 0){
			var Number pente = (yB-yA)/(xB-xA)
			logInfo("Humidity increase", "********************************")
			logInfo("Humidity increase", "(" + xA + ","+ yA +") (" + xB + "," + yB + ")")
			logInfo("Humidity increase", "Current humidity pente: " + pente)
			if (pente > 0.01){		
				logInfo("Humidity increase", "Auto start the ventillation because fast humidity increase")
				global_Vent_Status.sendCommand(3);				
			}
		}
end

/*
import org.openhab.core.library.types.*

 
rule "Initialize heating states"
	when 
		System started
	then		
		postUpdate(Heating_Target_Zone1, 22)
		postUpdate(Heating_Zone1, OFF)
end

rule "Start heating"
	when 
		Item EnOcean_sensor_01809DC1 changed or
		Item Heating_Target_Zone1 changed
	then		
		var Number target = 22
		var Number current = 22
		if(Heating_Target_Zone1.state instanceof DecimalType) target = Heating_Target_Zone1.state as DecimalType
		if(EnOcean_sensor_01809DC1.state instanceof DecimalType) current = EnOcean_sensor_01809DC1.state as DecimalType
	
		if (current < target){
			postUpdate(Heating_Zone1, ON)
		} else {
			postUpdate(Heating_Zone1, OFF)
		}
end

*/